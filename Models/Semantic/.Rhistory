#if(length(pot)==0){
#  # Take a point with minimal density ?
#  pot = which(grid==min(grid),arr.ind=TRUE)
#}
# simplify : take deterministiquely (almost, after two exps only two points possible)
# BUT not close to border
#rbord = 2*rmax*log(Pmax/tolThreshold)
rbord = 2*rmax
# random center
if(max(grid)==0){
# random if no center yet
center = matrix(runif(2,min=rbord+1,max=gridSize-rbord),nrow=1)
}
else {
# else find min pop area not too close to border
pot = which(grid==min(grid[(rbord+1):(gridSize-rbord),(rbord+1):(gridSize-rbord)]),arr.ind=TRUE)
row = sample(nrow(pot),1)
center = matrix(pot[row,],nrow=1)
}
# add kernel : use kernlab laplace kernel or other
if(kernel_type=="poisson"){ker=laplacedot(sigma=1/r_i)}
if(kernel_type=="gaussian"){ker=rbfdot(sigma=1/(2*r_i^2))}
#if(kernel_type="quadratic"){ker=} # is quad kernel available ?
grid = grid + (d_i * matrix(kernelMatrix(kernel=laplacedot(sigma=1/r_i),x=coords,y=center),nrow=gridSize))
}
if(proba==TRUE){grid = grid / sum(grid)}
return(grid)
}
test = spatializedExpMixtureDensity(100,2,0.7)
library(kernlab)
test = spatializedExpMixtureDensity(100,10,0.7)
#test = spatializedExpMixtureDensity(100,3,0.7)
test = spatializedExpMixtureDensity(100,3,0.7)
test = spatializedExpMixtureDensity(100,4,0.7)
test = spatializedExpMixtureDensity(100,5,0.7)
spatializedExpMixtureDensity <- function(gridSize,N,alpha,proba=TRUE,rmin=0,rmax=0,Pmax=1,tolThreshold=0,kernel_type="poisson"){
if(rmin==0){rmin = gridSize/N}
if(rmax==0){rmax = gridSize/N}
# patches of the grid are 1 unit size (in r_min/max units)
grid = matrix(0,gridSize,gridSize)
# matrix of coordinates
coords = matrix(c(c(matrix(rep(1:gridSize,gridSize),nrow=gridSize)),c(matrix(rep(1:gridSize,gridSize),nrow=gridSize,byrow=TRUE))),nrow=gridSize^2)
# first draw param distribs ? not needed
# for exp distribs, P_i = 2pi*d_i*r_i^2
#  -> take P from deterministic distrib ; draw r.
for(i in 1:N){
show(i)
pop_i = Pmax*i^{-alpha}
r_i = runif(1,min=rmin,max=rmax)
d_i = pop_i / (2*pi*(r_i^2))
# find origin of that kernel
#  -> one of points such that : d(bord) > rcut and \forall \vec{x}\in D(rcut),d(\vec{x})<tolThr.
#pot = which(!pseudoClosing(grid>tolThreshold,r_i),arr.ind=TRUE)
#show(length(pot))
#if(length(pot)==0){
#  # Take a point with minimal density ?
#  pot = which(grid==min(grid),arr.ind=TRUE)
#}
# simplify : take deterministiquely (almost, after two exps only two points possible)
# BUT not close to border
#rbord = 2*rmax*log(Pmax/tolThreshold)
rbord = 2*rmax
# random center
if(max(grid)==0){
# random if no center yet
center = matrix(runif(2,min=rbord+1,max=gridSize-rbord),nrow=1)
}
else {
# else find min pop area not too close to border
pot = which(grid==min(grid[(rbord+1):(gridSize-rbord),(rbord+1):(gridSize-rbord)]),arr.ind=TRUE)
row = sample(nrow(pot),1)
center = matrix(pot[row,],nrow=1)
}
# add kernel : use kernlab laplace kernel or other
if(kernel_type=="poisson"){ker=laplacedot(sigma=1/r_i)}
if(kernel_type=="gaussian"){ker=rbfdot(sigma=1/(2*r_i^2))}
#if(kernel_type="quadratic"){ker=} # is quad kernel available ?
grid = grid + (d_i * matrix(kernelMatrix(kernel=laplacedot(sigma=1/r_i),x=coords,y=center),nrow=gridSize))
}
if(proba==TRUE){grid = grid / sum(grid)}
return(grid)
}
test = spatializedExpMixtureDensity(100,5,0.7)
test = spatializedExpMixtureDensity(100,4,0.7)
test = spatializedExpMixtureDensity(100,5,0.7)
persp3D(z=test)
library(plot3D)
persp3D(z=test)
test = spatializedExpMixtureDensity(100,10,0.7)
test = spatializedExpMixtureDensity(100,20,0.7)
persp3D(z=test)
library(igraph)
hep(simplify())
help(simplify)
localGraph=list()
localGraph$gg
is.null(localGraph$gg)
48*400
help(try)
#'   ! assuming q > 0
quantilesToHist<-function(q){
mids=c();density=c()
a = 1/length(q)
qq=c(0,q)
for(i in 1:length(q)){mids = append(mids,(qq[i]+qq[i+1])/2);density=append(density,a/(qq[i+1]-qq[i]))}
res=list()
res$mids=mids;res$density=density
return(res)
}
quantilesToHist(1:10)
help("try")
tryCatch({x+1})
tryCatch({x+1},error=function(e){show("tos")})
tryCatch({x+1},error=function(e){return("tos")})
tryCatch({x+1},error=function(e){return(2)})
tryCatch({x+1},error=function(e){res=2})
res
library(raster)
help("focal")
strsplit("1998;2008;2554")
strsplit("1998;2008;2554",";")
strsplit("1998;2008;2554",";")[[1]]
kwNum = 100000
yearRange=c(1976,1977,1978,1979,1980)
year = paste0(as.character(yearRange[1]),"-",as.character(yearRange[length(yearRange)]))
paste0('relevant.relevant_',year,'_full_',kwNum)
paste0('relevant.relevant_',year,'_full_',kwNum)
5*6*3*10*5
5*6*3*10*5*3
5*6*3*10*5*3*20
5*6*3*10*5*7*20
getwd()
pop = load('Data/GibratSim/countriesPop.RData')
pop
CHina
China
library(dplyr)
as.tbl(China)
China[9000:9100,]
as.tbl(China_Historic)
mmax(China$`2010`)
max(China$`2010`)
hist(China$`2010`,breaks=500)
library(ggplot2)
g=ggplot(China)
d=data.frame()
for(j in 5:8){
d=rbind(d,cbind(sort(China[,j],decreasing = TRUE),1:nrow(China),rep(colnames(China)[j],nrow(China))))
}
sort(China[,j],decreasing = TRUE)
1:nrow(China)
d=data.frame()
for(j in 5:8){
d=rbind(d,data.frame(sort(China[,j],decreasing = TRUE),1:nrow(China),rep(colnames(China)[j],nrow(China))))
}
nrow(China)
China[,j]
d=data.frame()
for(j in 5:8){
d=rbind(d,data.frame(sort(China[,j],decreasing = TRUE,na.last = TRUE),1:nrow(China),rep(colnames(China)[j],nrow(China))))
}
colnames(d)<-c("size","rank","year")
colnames(d)
dim(d)
g=ggplot(d)
g+geom_point(aes(x=rnake,y=size,colour=year))
g+geom_point(aes(x=rank,y=size,colour=year))
g+geom_point(aes(x=log(rank),y=log(size),colour=year))
help("geom_bar")
192000 * 109 / 200
192000 * 109 / 200 / 3600
192000 * 109 / 200 / 3600 / 10
192000 * 109 / 200 / 3600 / 20
14/1.38
50*49/2
d=read.csv('/Users/Juste/Documents/ComplexSystems/EnergyPrice/Models/DataCollection/test/data/test_all.csv')
d=read.csv('/Users/Juste/Documents/ComplexSystems/EnergyPrice/Models/DataCollection/test/data/test_all.csv',sep=";")
d
head(d)
d=read.csv('/Users/Juste/Documents/ComplexSystems/EnergyPrice/Models/DataCollection/test/data/test_all.csv',sep=";",header=FALSE)
head(d)
head(d,n = 100)
which(d[,2]==0)
which(d[,2]==2)
unique(d[,2])
help(apply)
help(Matrix)
library(Matrix)
help("Matrix")
library(raster)
help("focal")
NCmisc::estimate.memory()
install.packages("NCmisc")
NCmisc::estimate.memory()
library(NCmisc)
help("estimate.memory")
library(Matrix)
library(ggplot2)
library(dplyr)
library(reshape2)
setwd(paste0(Sys.getenv('CS_HOME'),'/PatentsMining/Models/Semantic'))
#wyears = 1980:2012
wyears = 1980:2007
windowSize=5
kwLimit="100000"
dispth=0.06
ethunit="4.1e-05"
classifdir = paste0('classification_window',windowSize,'_kwLimit',kwLimit,'_dispth',dispth,'_ethunit',ethunit)
overlaps = c();years=c();measures=c();types=c();filters=c();nullovs=c();classnum=c();pcount=c();gc()
ovsize=c()
for(year in wyears){
load(paste0('processed/',classifdir,'/processed_',(year-windowSize+1),"-",year,'.RData'));show(year)
technoprobas=currentprobas$technoprobas;semprobas=currentprobas$semprobas;rm(currentprobas);gc()
techov=t(technoprobas)%*%technoprobas;
diag(techov)<-0
semov=t(semprobas)%*%semprobas;
diag(semov)<-0
interov=t(technoprobas)%*%semprobas
#nullovs=append(nullovs,length(which(techov==0)));nullovs=append(nullovs,length(which(semov==0)))
#ovsize=append(ovsize,c(sum(techov),sum(semov)))
#types=append(types,c("techno","semantic"));years=append(years,c(year,year))
#classnum=append(classnum,ncol(techov));classnum=append(classnum,ncol(semov))
#pcount=append(pcount,c(nrow(semprobas),nrow(semprobas)))
# NON NORMALIZED
#overlaps=append(overlaps,as.numeric(interov));n=length(as.numeric(interov));years=append(years,rep(year,n));types=append(types,rep("techno",n))#;measures=append(measures,rep("real",n));filters=append(filters,rep("all",n))
#overlaps=append(overlaps,as.numeric(techov));n=length(as.numeric(techov));years=append(years,rep(year,n));types=append(types,rep("techno",n))#;measures=append(measures,rep("real",n));filters=append(filters,rep("all",n))
#overlaps=append(overlaps,as.numeric(semov));n=length(as.numeric(semov));years=append(years,rep(year,n));types=append(types,rep("semantic",n))#;measures=append(measures,rep("real",n));filters=append(filters,rep("all",n))
#inds=which(techov>0);overlaps=append(overlaps,techov[inds]);n=length(inds);years=append(years,rep(year,n));types=append(types,rep("techno",n))#;measures=append(measures,rep("real",n));filters=append(filters,rep("positive",n))
#inds=which(semov>0);overlaps=append(overlaps,semov[inds]);n=length(inds);years=append(years,rep(year,n));types=append(types,rep("semantic",n))#;measures=append(measures,rep("real",n));filters=append(filters,rep("positive",n))
# # NORMALIZED PATENT COUNT
overlaps=append(overlaps,as.numeric(interov)/nrow(technoprobas));n=length(as.numeric(interov));years=append(years,rep(year,n));types=append(types,rep("inter-classifications",n));measures=append(measures,rep("norm-patents",n));#filters=append(filters,rep("all",n))
overlaps=append(overlaps,as.numeric(techov)/nrow(technoprobas));n=length(as.numeric(techov));years=append(years,rep(year,n));types=append(types,rep("technological classification",n));measures=append(measures,rep("norm-patents",n));#filters=append(filters,rep("all",n))
overlaps=append(overlaps,as.numeric(semov)/nrow(semprobas));n=length(as.numeric(semov));years=append(years,rep(year,n));types=append(types,rep("semantic classification",n));measures=append(measures,rep("norm-patents",n));#filters=append(filters,rep("all",n))
#inds=which(techov>0);overlaps=append(overlaps,techov[inds]/nrow(technoprobas));n=length(inds);years=append(years,rep(year,n));types=append(types,rep("techno",n));#measures=append(measures,rep("norm-patents",n));filters=append(filters,rep("positive",n))
#inds=which(semov>0);overlaps=append(overlaps,semov[inds]/nrow(semprobas));n=length(inds);years=append(years,rep(year,n));types=append(types,rep("semantic",n));#measures=append(measures,rep("norm-patents",n));filters=append(filters,rep("positive",n))
# # RELATIVE OVERLAP
technorm=Matrix(1,nrow(techov),ncol(techov))%*%Diagonal(x=colSums(technoprobas));
semnorm=Matrix(1,nrow(semov),ncol(semov))%*%Diagonal(x=colSums(semprobas));
internorm=2*(Diagonal(x=1/colSums(technoprobas))%*%Matrix(1,ncol(technoprobas),ncol(semprobas)))+(Matrix(1,ncol(technoprobas),ncol(semprobas))%*%Diagonal(x=1/colSums(semprobas)))
interov=interov*internorm
techov=techov*2/(technorm+t(technorm))
semov=semov*2/(semnorm+t(semnorm))
overlaps=append(overlaps,as.numeric(interov));n=length(as.numeric(interov));years=append(years,rep(year,n));types=append(types,rep("inter-classifications",n));measures=append(measures,rep("relative",n));#filters=append(filters,rep("all",n))
overlaps=append(overlaps,as.numeric(techov));n=length(as.numeric(techov));years=append(years,rep(year,n));types=append(types,rep("technological classification",n));measures=append(measures,rep("relative",n));#filters=append(filters,rep("all",n))
overlaps=append(overlaps,as.numeric(semov));n=length(as.numeric(semov));years=append(years,rep(year,n));types=append(types,rep("semantic classification",n));measures=append(measures,rep("relative",n));#filters=append(filters,rep("all",n))
##inds=which(techov>0);overlaps=append(overlaps,techov[inds]/nrow(technoprobas));n=length(inds);years=append(years,rep(year,n));types=append(types,rep("techno",n));#measures=append(measures,rep("relative",n));filters=append(filters,rep("positive",n))
##inds=which(semov>0);overlaps=append(overlaps,semov[inds]/nrow(semprobas));n=length(inds);years=append(years,rep(year,n));types=append(types,rep("semantic",n));#measures=append(measures,rep("relative",n));filters=append(filters,rep("positive",n))
rm(techov,semov,technorm,semnorm,technoprobas,semprobas);gc()
}
resdir=paste0(Sys.getenv('CS_HOME'),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/')
df=data.frame(overlap=overlaps,year=as.character(years),type=as.character(types),measure=measures)#,filter=filters)
rm(overlaps,years,types);gc()
save(df,file="res/full-overlaps.RData")
library(Matrix)
library(ggplot2)
library(dplyr)
library(reshape2)
setwd(paste0(Sys.getenv('CS_HOME'),'/PatentsMining/Models/Semantic'))
#wyears = 1980:2012
wyears = 1980:2007
windowSize=5
kwLimit="100000"
dispth=0.06
ethunit="4.1e-05"
classifdir = paste0('classification_window',windowSize,'_kwLimit',kwLimit,'_dispth',dispth,'_ethunit',ethunit)
load("res/full-overlaps.RData")
plotsIntraOverlap <-function(measure,xlabel){
g=ggplot(df[df$measure==measure&df$type!="inter-classifications",],aes(x=overlap,colour=year))
g+geom_density(alpha=0.25)+xlab(measure)+ylab("density")+
scale_x_log10()+facet_wrap(~type,scales="free_y")+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_density_semcounts.pdf'),width=10,height=5)
rm(g);gc()
dsum = df[df$measure==measure&df$type!="inter-classifications",]%>% group_by(year,type) %>% summarise(meanoverlap=mean(overlap,na.rm=TRUE),mi=quantile(overlap,0.1,na.rm=TRUE),ma=quantile(overlap,0.9,na.rm=TRUE))
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,group=type))#,colour=type,group=type),show.legend = FALSE)
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+#geom_errorbar(aes(ymin=mi,ymax=ma))+
facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
}
plotsOverlap("norm-patents","normalized overlap")
plotsIntraOverlap("norm-patents","normalized overlap")
plotsIntraOverlap <-function(measure,xlabel){
g=ggplot(df[df$measure==measure&df$type!="inter-classifications",],aes(x=overlap,colour=year))
g+geom_density(alpha=0.25)+xlab(xlabel)+ylab("density")+
scale_x_log10()+facet_wrap(~type,scales="free_y")+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_density_semcounts.pdf'),width=10,height=5)
rm(g);gc()
dsum = df[df$measure==measure&df$type!="inter-classifications",]%>% group_by(year,type) %>% summarise(meanoverlap=mean(overlap,na.rm=TRUE),mi=quantile(overlap,0.1,na.rm=TRUE),ma=quantile(overlap,0.9,na.rm=TRUE))
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,colour=type,group=type))#,show.legend = FALSE)
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
}
plotsIntraOverlap("norm-patents","normalized overlap")
plotsIntraOverlap <-function(measure,xlabel){
# g=ggplot(df[df$measure==measure&df$type!="inter-classifications",],aes(x=overlap,colour=year))
# g+geom_density(alpha=0.25)+xlab(xlabel)+ylab("density")+
#   scale_x_log10()+facet_wrap(~type,scales="free_y")+
#   theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
# ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_density_semcounts.pdf'),width=10,height=5)
#
# rm(g);gc()
dsum = df[df$measure==measure&df$type!="inter-classifications",]%>% group_by(year,type) %>% summarise(meanoverlap=mean(overlap,na.rm=TRUE),mi=quantile(overlap,0.1,na.rm=TRUE),ma=quantile(overlap,0.9,na.rm=TRUE))
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,colour=type,group=type),show.legend = FALSE)
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
}
plotsIntraOverlap("norm-patents","normalized overlap")
plotsIntraOverlap <-function(measure,xlabel){
# g=ggplot(df[df$measure==measure&df$type!="inter-classifications",],aes(x=overlap,colour=year))
# g+geom_density(alpha=0.25)+xlab(xlabel)+ylab("density")+
#   scale_x_log10()+facet_wrap(~type,scales="free_y")+
#   theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
# ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_density_semcounts.pdf'),width=10,height=5)
#
# rm(g);gc()
dsum = df[df$measure==measure&df$type!="inter-classifications",]%>% group_by(year,type) %>% summarise(meanoverlap=mean(overlap,na.rm=TRUE),mi=quantile(overlap,0.1,na.rm=TRUE),ma=quantile(overlap,0.9,na.rm=TRUE))
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,colour=type,group=type),show.legend = FALSE)
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
}
plotsIntraOverlap("norm-patents","normalized overlap")
measure="norm-patents"
xlabel="normalized overlap"
dsum = df[df$measure==measure&df$type!="inter-classifications",]%>% group_by(year,type) %>% summarise(meanoverlap=mean(overlap,na.rm=TRUE),mi=quantile(overlap,0.1,na.rm=TRUE),ma=quantile(overlap,0.9,na.rm=TRUE))
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,colour=type,group=type))
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(show.legend = FALSE,axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,colour=type,group=type,show.legend = FALSE))
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,colour=type,group=type),show.legend = FALSE)
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,colour=type,group=type),show.legend = TRUE)
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,colour=type,group=type))
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
facet_wrap(~type,scales ="free_y",show.legend = TRUE)+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
help(theme)
dsum = df[df$measure==measure&df$type!="inter-classifications",]%>% group_by(year,type) %>% summarise(meanoverlap=mean(overlap,na.rm=TRUE),mi=quantile(overlap,0.1,na.rm=TRUE),ma=quantile(overlap,0.9,na.rm=TRUE))
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,colour=type,group=type))
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(legend.position="none",axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
plotsIntraOverlap <-function(measure,xlabel){
g=ggplot(df[df$measure==measure&df$type!="inter-classifications",],aes(x=overlap,colour=year))
g+geom_density(alpha=0.25)+xlab(xlabel)+ylab("density")+
scale_x_log10()+facet_wrap(~type,scales="free_y")+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_density_semcounts.pdf'),width=10,height=5)
rm(g);gc()
dsum = df[df$measure==measure&df$type!="inter-classifications",]%>% group_by(year,type) %>% summarise(meanoverlap=mean(overlap,na.rm=TRUE),mi=quantile(overlap,0.1,na.rm=TRUE),ma=quantile(overlap,0.9,na.rm=TRUE))
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,colour=type,group=type))
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(legend.position="none",axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_all_ts_semcounts.pdf'),width=10,height=5)
}
plotsIntraOverlap("relative","relative overlap")
plotsInterOverlap <-function(measure,xlabel){
g=ggplot(df[df$measure==measure&df$type=="inter-classifications",],aes(x=overlap,colour=year))
g+geom_density(alpha=0.25)+xlab(xlabel)+ylab("density")+scale_x_log10()
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_interclassif_all_density_semcounts.pdf'),width=10,height=5)
rm(g);gc()
dsum = df[df$measure==measure&df$type!="inter-classifications",]%>% group_by(year,type) %>% summarise(meanoverlap=mean(overlap,na.rm=TRUE),mi=quantile(overlap,0.1,na.rm=TRUE),ma=quantile(overlap,0.9,na.rm=TRUE))
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,group=type))
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_interclassif_all_ts_semcounts.pdf'),width=10,height=5)
}
plotsInterOverlap("norm-patents","normalized overlap")
measure
xlabel
dsum = df[df$measure==measure&df$type=="inter-classifications",]%>% group_by(year,type) %>% summarise(meanoverlap=mean(overlap,na.rm=TRUE),mi=quantile(overlap,0.1,na.rm=TRUE),ma=quantile(overlap,0.9,na.rm=TRUE))
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,group=type))
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_interclassif_all_ts_semcounts.pdf'),width=10,height=5)
plotsInterOverlap <-function(measure,xlabel){
g=ggplot(df[df$measure==measure&df$type=="inter-classifications",],aes(x=overlap,colour=year))
g+geom_density(alpha=0.25)+xlab(xlabel)+ylab("density")+scale_x_log10()
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_interclassif_all_density_semcounts.pdf'),width=10,height=5)
rm(g);gc()
dsum = df[df$measure==measure&df$type=="inter-classifications",]%>% group_by(year,type) %>% summarise(meanoverlap=mean(overlap,na.rm=TRUE),mi=quantile(overlap,0.1,na.rm=TRUE),ma=quantile(overlap,0.9,na.rm=TRUE))
gsum=ggplot(dsum,aes(x=year,y=meanoverlap,group=type))
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+ylab(paste0("mean ",xlabel))+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/overlap/',measure,'_interclassif_all_ts_semcounts.pdf'),width=10,height=5)
}
plotsInterOverlap("relative","relative overlap")
library(Matrix)
library(ggplot2)
library(dplyr)
library(reshape2)
setwd(paste0(Sys.getenv('CS_HOME'),'/PatentsMining/Models/Semantic'))
#wyears = 1980:2012
wyears = 1980:2007
windowSize=5
kwLimit="100000"
dispth=0.06
ethunit="4.1e-05"
classifdir = paste0('classification_window',windowSize,'_kwLimit',kwLimit,'_dispth',dispth,'_ethunit',ethunit)
origs=c();cyears=c();types=c();
for(year in wyears){
show(year)
#load(paste0('probas_processed/processed_',year,'.RData'))
load(paste0('processed/',classifdir,'/processed_',(year-windowSize+1),"-",year,'.RData'))
technoprobas=currentprobas$technoprobas;semprobas=currentprobas$semprobas;rm(currentprobas);gc()
origs = append(origs,1 - rowSums(semprobas^2));types=append(types,rep("semantic classification",nrow(semprobas)))
origs = append(origs,1 - rowSums(technoprobas^2));types=append(types,rep("technological classification",nrow(technoprobas)))
cyears=append(cyears,rep(year,nrow(semprobas)+nrow(technoprobas)))
rm(semprobas,technoprobas);gc()
}
#save(origs,cyears,types,file='res/patentlevel_orig.RData')
#load('res/patentlevel_orig.RData')
show(paste0('Unclassified : ',length(which(origs<1))/length(origs)))
# 5.2 % of patent in total are not classified : quite ok
# techno patent origs
inds=origs<1
df = data.frame(originality=origs[inds],year=as.character(cyears[inds]),type=types[inds])
rm(origs,cyears,types);gc()
g=ggplot(df)
g+geom_density(aes(x=originality,colour=year))+facet_wrap(~type) +
xlab("patent diversity")+scale_y_log10()+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/diversity/patentlevelorigs_all_semcounts_log10.pdf'),width=10,height=5)
rm(g);gc()
g=ggplot(df[df$originality>0,])
g+geom_density(aes(x=originality,colour=year))+facet_wrap(~type) +
xlab("patent diversity")+scale_y_log10()+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/diversity/patentlevelorigs_positive_semcounts_log10.pdf'),width=10,height=5)
rm(g);gc()
# time series by year
byyearorigs = as.tbl(df) %>% group_by(year,type) %>% summarize(meanorig=mean(originality),count=n())
gsum=ggplot(byyearorigs,aes(x=year,y=meanorig,colour=type,group=type))
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+
xlab("year")+ylab("mean patent diversity") +
theme(legend.position = "none",axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/diversity/patentlevelorigs_all_ts_semcounts.pdf'),width=10,height=5)
byyearorigs = as.tbl(df[df$originality>0,]) %>% group_by(year,type) %>% summarize(meanorig=mean(originality),count=n())
gsum=ggplot(byyearorigs,aes(x=year,y=meanorig,colour=type,group=type))
labs=rep("",length(wyears));labs[seq(from=1,to=length(labs),by=5)]=as.character(wyears[seq(from=1,to=length(labs),by=5)])
gsum+geom_point()+geom_line()+facet_wrap(~type,scales ="free_y")+
scale_x_discrete(breaks=as.character(wyears),labels=labs)+
xlab("year")+ylab("mean patent diversity") +
theme(legend.position = "none",axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/diversity/patentlevelorigs_positive_ts_semcounts.pdf'),width=10,height=5)
g=ggplot(df)
g+geom_density(aes(x=originality,colour=year))+facet_wrap(~type) +
xlab("patent diversity")+#scale_y_log10()+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/diversity/patentlevelorigs_all_semcounts.pdf'),width=10,height=5)
rm(g);gc()
g=ggplot(df[df$originality>0,])
g+geom_density(aes(x=originality,colour=year))+facet_wrap(~type) +
xlab("patent diversity")+#scale_y_log10()+
theme(axis.title = element_text(size = 22), axis.text.x = element_text(size = 15),  axis.text.y = element_text(size = 15))
ggsave(file=paste0(Sys.getenv("CS_HOME"),'/PatentsMining/Results/Semantic/Analysis/window5/diversity/patentlevelorigs_positive_semcounts.pdf'),width=10,height=5)
rm(g);gc()
